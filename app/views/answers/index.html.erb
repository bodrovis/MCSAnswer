<% provide :page_title, t('.title') %>
<% currently_at t('menu.games') %>

<h1 class="mb-4"><%= t('.title') %></h1>

<div class="mb-3">
  <%= link_to 'Игра', game_path(@game), class: 'btn btn-primary' %>
  <%= link_to 'Команды и составы', game_playing_teams_path(@game), class: 'btn btn-secondary' %>
</div>

<%= turbo_stream_from(@game, :answers) %>

<div class="table-responsive">
  <table class="table table-striped table-hover table-bordered">
    <thead>
      <tr>
        <th class="col-2">#</th>
        
        <% @questions.each do |question| %>
          <th class="col-2"><%= question.position %></th>
        <% end %>

        <th class="col-1">Итог</th>
      </tr>
    </thead>

    <tbody>
      <% @playing_teams.each do |team| %>
        <tr data-controller="team-results" data-team-results-admin-value="<%= policy(@game).manage_questions? %>">
          <th scope="row"><%= team.title %></th>

          <% @questions.each do |question| %>
            <%= render 'answer', answer: question.answer_by(team), team: team, question: question %>
          <% end %>

          <td>
            <strong data-team-results-target="total"></strong>
          </td>
        </tr>
      <% end %>
    </tbody>
  </table>
</div>
